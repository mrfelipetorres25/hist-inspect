# Visão Geral da Arquitetura e Funcionamento #

Essa página apresenta o fluxo de funcionamento e alguns aspectos técnicos da ferramenta Hist-Inspect. As funcionalidades da Hist-Inspect foram implementadas em dois módulos separados utilizando a linguagem Java. O primeiro é um módulo de geração de gráficos de evolução, implementado através da plataforma Eclipse. O segundo é um módulo de geração de relatórios de detecções, resultantes da aplicação de estratégias de detecção. Esse segundo módulo, por enquanto é disponibilizado através de uma interface de linha de comando. Entretanto, existe a intenção de migrá-lo para que também esteja sobre a plataforma do Eclipse. Por questões óbvias de espaço, iremos apresentar apenas o segundo módulo, pois possui as funcionalidades que julgamos mais relevantes ao contexto de estratégias de detecção. Os integrantes desse módulo são apresentados pela figura apresentada a seguir.

![http://lh5.ggpht.com/_P1kXrtn0WgE/TCq1VYRVhHI/AAAAAAAAASk/m74P-fFYLdM/processo-histinspect.png](http://lh5.ggpht.com/_P1kXrtn0WgE/TCq1VYRVhHI/AAAAAAAAASk/m74P-fFYLdM/processo-histinspect.png)

Como mostra a figura acima, o módulo toma como entrada um arquivo chamado _Lista de Arquivos de Métricas_. Essa lista, por sua vez, possui a localização de outros arquivos que possuem os valores de métricas convencionais calculados em cada uma das versões do sistema. Já o _Oráculo de Anomalias_ é uma entrada opcional e apenas é fornecida se o usuário desejar calcular medidas de precisão e revocação dos resultados gerados por uma estratégias de detecção. Ambas as entradas são implementadas através de arquivos XML. Os _n_ arquivos com as métricas convencionais das _n_ versões do sistema são arquivos _.mtbl_ com os resultados de métricas convencionais geradas através da ferramenta Together. Optou-se por não efetuar o cálculo de métricas convencionais, uma vez que muitas ferramentas já disponibilizam tais resultados. Nesse caso, são utilizados os resultados de métricas convencionais geradas pela Together, escolhida, principalmente, por ser uma ferramenta de medição bem conhecida e aceita.

O elemento _Parser_ transforma a representação textual do XML de entrada em um modelo de domínio a ser utilizado pela aplicação. Entretanto, o modelo gerado pelo _Parser_  armazena apenas informações de métricas convencionais. O _Gerador do Modelo SH_ é quem lê as _Especificações das Métricas Sensíveis a História_ e transformar o modelo convencional em um _Modelo Senvível à História_. Grande parte do _Parser_ foi gerado utilizando o framework XMLBeans (http://xmlbeans.apache.org/), enquanto a _Especificação de Métricas SH_ foi feita através de classes que implementam uma interface Java específica para tais métricas. A partir do _Modelo com Métricas SH_ de cada entidade é transferida ao _Avaliador de Regras_ a responsabilidade de realizar as detecções. Nesse caso, tal elemento carrega dois catálogos, um contendo as especificações das regras ou estratégias de detecção e outro contendo as anomalias de modularidade a serem consideradas. Esses dois catálogos são implementados através de arquivos XML. O _Avaliador de Regras_ gerencia o contexto de execução do JavaScript, criando as variáveis que representam as métricas e atribuindo os seus respectivos valores dependendo do entidade que está sendo avaliada no momento (pacote, classe ou método). Finalmente, as regras indicadas pelo atributo "expression" são aplicadas aos módulos do sistema. Caso a expressão de detecção seja verdadeira para uma determinado módulo, o _Avaliador de Regras_ destaca a ocorrência da anomalia. A anomalia avaliada pela regra é indicada pelo elemento "anomaly".

Finalmente, como mostra a figura, o _Gerador de Relatórios_ combina as informações produzidas pelo _Avaliador de Regras_ com um _Template HTML_, gerando o _Relatório_ que será apresentado ao usuário. O _Gerador de Relatórios_ processa templates de relatórios utilizando a linguagem de templates Velocity (http://velocity.apache.org/). Opcionalmente, é possivel também inserir nesse relatório de detecções informações sobre falsos positivos e negativos, precisão e revocação das estratégias aplicadas. Esses são calculados  a partir do elemento _Oráculo de Anomalias_.